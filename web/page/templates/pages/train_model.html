{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h1>Modell trainieren</h1>

    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <form method="post">
        {% csrf_token %}

        <!-- Standard-Parameter -->
        <div class="form-group mb-3">
            <label for="epochs">Epochen</label>
            <input type="number" name="epochs" id="epochs" class="form-control" value="50" min="1">
            <small class="form-text text-muted">
                Wie oft der komplette Datensatz durchlaufen wird. Mehr Epochen = längeres Training, kann aber genauer werden.
            </small>
        </div>

        <div class="form-group mb-3">
            <label for="imgsz">Bildgröße (px)</label>
            <input type="number" name="imgsz" id="imgsz" class="form-control" value="640" min="32">
            <small class="form-text text-muted">
                Größe, auf die alle Bilder vor dem Training verkleinert werden. Höher = mehr Details, aber langsamer.
            </small>
        </div>

        <hr>

       <!-- Trainingsmodus -->
      <div class="form-group mb-3">
          <label class="d-block">Trainingsmodus</label>

          <div class="form-check">
              <input class="form-check-input" type="radio" name="mode" id="mode_fresh" value="fresh">
              <label class="form-check-label" for="mode_fresh">
                  Neu trainieren
              </label>
              <small class="form-text text-muted">
                  Startet komplett von Null mit zufälligen Gewichten. Am besten, wenn sich der gesamte Datensatz geändert hat.
              </small>
          </div>

          <div class="form-check">
              <input class="form-check-input" type="radio" name="mode" id="mode_resume" value="resume" checked>
              <label class="form-check-label" for="mode_resume">
                  Weitertrainieren (Resume)
              </label>
              <small class="form-text text-muted">
                  Setzt das letzte Training exakt fort – gleiche Einstellungen, gleiche Daten.
              </small>
          </div>

          <div class="form-check">
              <input class="form-check-input" type="radio" name="mode" id="mode_finetune" value="finetune">
              <label class="form-check-label" for="mode_finetune">
                  Fine-Tuning von Checkpoint
              </label>
              <small class="form-text text-muted">
                  Startet mit einem vorhandenen Modell, erlaubt aber neue Einstellungen und gezieltes Anpassen.
              </small>
          </div>
      </div>


        <!-- Checkpoint-Pfad -->
        <div class="form-group mb-3">
            <label for="ckpt_path">Checkpoint-Pfad</label>
            <input type="text" name="ckpt_path" id="ckpt_path" class="form-control" placeholder="Pfad zu .pt Datei">
            <small class="form-text text-muted">
                Datei mit den bisherigen Modellgewichten (.pt). Leer lassen, um automatisch den letzten besten Stand zu nehmen.
            </small>
        </div>

        <!-- Fine-Tuning Parameter -->
        <div class="form-group mb-3">
            <label for="lr0">Learning Rate (lr0)</label>
            <input type="number" step="0.0001" name="lr0" id="lr0" class="form-control" value="0.001">
            <small class="form-text text-muted">
                Wie stark die Gewichte pro Schritt angepasst werden. Kleinere Werte lernen langsamer, sind aber oft stabiler.
            </small>
        </div>

        <div class="form-group mb-3">
            <label for="batch">Batch-Größe</label>
            <input type="number" name="batch" id="batch" class="form-control" value="16">
            <small class="form-text text-muted">
                Anzahl Bilder, die gleichzeitig verarbeitet werden. Größer = schneller, benötigt aber mehr RAM/GPU-Speicher.
            </small>
        </div>

        <div class="form-group mb-3">
            <label for="patience">Early-Stopping-Patience</label>
            <input type="number" name="patience" id="patience" class="form-control" value="50">
            <small class="form-text text-muted">
                Beendet das Training frühzeitig, wenn sich das Ergebnis nach so vielen Epochen nicht verbessert.
            </small>
        </div>

        <div class="form-group mb-3">
            <label for="freeze">Ebenen einfrieren</label>
            <input type="number" name="freeze" id="freeze" class="form-control" value="0">
            <small class="form-text text-muted">
                Bestimmt, wie viele Anfangsschichten des Netzes eingefroren werden (0 = alles trainieren, z. B. 10 = Backbone einfrieren).
            </small>
        </div>

        <div class="form-group mb-3">
            <label for="optimizer">Optimizer</label>
            <select name="optimizer" id="optimizer" class="form-control">
                <option value="">Standard</option>
                <option value="SGD">SGD</option>
                <option value="Adam">Adam</option>
                <option value="AdamW">AdamW</option>
            </select>
            <small class="form-text text-muted">
                Algorithmus, der die Gewichte anpasst. Standard passt für die meisten Fälle.
            </small>
        </div>

        <button type="submit" class="btn btn-success">Training starten</button>
    </form>
</div>
{% endblock %}
